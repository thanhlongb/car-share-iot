{% extends "base.html" %}
{% block content %}
<div class="form-group justify-content-between">
    <h1 class="d-inline">Cars</h1>
</div>

<div class="form-group">
    <div class="input-group mb-3">
        <div class="input-group-prepend">
            <span class="input-group-text">Search:</span>
        </div>
        <input type="text" class="form-control" id="search-text"
            aria-label="Enter your query here..."
            placeholder="Enter your query here...">
    </div>
</div>

<table class="table table-hover" style="width:100%">
    <thead>
      <tr class="table-secondary">
        <th>ID</th>
        <th>Make</th>
        <th>Color</th>
        <th>Body Type</th>
        <th>Seats</th>
        <th>Cost Per Hour</th>
        <th>Available</th>
        <th>Location</th>
        <th>Book</th>
      </tr>
    </thead>
    <tbody id="search-table">
      {% for car in cars %}
          <tr id="row{{ car.id }}">
              <td>{{ car.id }}</td>
              <td>{{ car.make }}</td>
              <td>{{ car.color }}</td>
              <td>{{ car.body_type }}</td>
              <td>{{ car.seats }}</td>
              <td>{{ car.cost_per_hour }}</td>
              <td>{{ "yes" if car.available else "no" }}</td>
              <td>{{ car.current_location }}</td>
              <td>
                <button onclick='booking_car({{ car.id }})' type="button" class="btn btn-sm btn-danger" data-toggle="modal" data-target="#delete-modal" title="Delete">
                    <i class="fa fa-trash" aria-hidden="true"></i>
                  </button>
              </td>
            </tr>
      {% endfor %}
    </tbody>
    </table>

<div id="booking-modal" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title"> Booking car </h4>
                <button type="button" class="close"
                    data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <p>Car ID: <span id="booked-car"></span></p>
                <input type="text" class="form-control" id="duration"
                    aria-label="Enter number of hours you want to rent a car"
                    placeholder="Enter number of hourss you want to rent a car">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary"
                    id="book-btn">Book</button>
            </div>
        </div>

    </div>
</div>

{% endblock %}

{% block script %}
{{ super() }}
<!-- search car function -->
<script>
    $(document).ready(function () {
        $("#search-text").on("keyup", function () {
            var value = $(this).val().toLowerCase();
            $("#search-table tr").filter(function () {
                $(this).toggle($(this).text()
                    .toLowerCase().indexOf(value) >
                    -1)
            });
        });
    });
</script>

<!-- Book btn handler -->
<script>
    function booking_car(car_id) {
        $('#booked-car').text(car_id);
    }

    $("#book-btn").click(function () {
        car_id = $('#booked-car').text();
        duration = $('#duration').val();
        $.ajax({
            url: '{{ url_for("bookings.book") }}',
            data: {
                car_id: car_id,
                duration: duration,
            },
            type: 'POST',
            success: function (res) {
                $('#booking-modal').modal('hide');
                $('#card' + car_id).fadeOut();
                $('#card' + car_id).remove();
            }
        })
    });
</script>
{% endblock %}